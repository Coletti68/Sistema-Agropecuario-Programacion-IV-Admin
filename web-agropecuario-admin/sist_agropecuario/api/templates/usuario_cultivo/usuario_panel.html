{% extends 'base.html' %}
{% block title %}Usuarios-Cultivos{% endblock %}
{% block header %}Panel de Usuario-Cultivo{% endblock %}

{% block content %}
<div class="card">
    <form method="get">
        <label>Usuario:</label>
        <select name="usuarioid">
            <option value="">Todos</option>
            {% for u in usuarios %}
                <option value="{{ u.pk }}" {% if usuario_id == u.pk %}selected{% endif %}>{{ u.nombre }}</option>
            {% endfor %}
        </select>

        <label>Cultivo:</label>
        <select name="cultivoid">
            <option value="">Todos</option>
            {% for c in cultivos %}
                <option value="{{ c.pk }}" {% if cultivo_id == c.pk %}selected{% endif %}>{{ c.nombre }}</option>
            {% endfor %}
        </select>

        <button type="submit" class="btn-primary">Filtrar</button>
    </form>
</div>

<div class="card">
    <table>
        <tr>
            <th>ID</th>
            <th>Usuario</th>
            <th>Cultivo</th>
            <th>Latitud</th>
            <th>Longitud</th>
            <th>Fecha Siembra</th>
            <th>Acciones</th>
        </tr>
        {% for a in asignaciones %}
        <tr>
            <td>{{ a.usuariocultivoid }}</td>
            <td>{{ a.usuarioid.nombre }}</td>
            <td>{{ a.cultivoid.nombre }}</td>
            <td>{{ a.latitud }}</td>
            <td>{{ a.longitud }}</td>
            <td>{{ a.fechasiembra }}</td>
            <td>
                <a href="{% url 'editar_usuariocultivo' a.pk %}">Editar</a> |
                <a href="{% url 'cultivos_por_usuario' a.usuarioid.pk %}">Ver Cultivos</a> |
                {% if a.activo %}
                    <a href="{% url 'desactivar_usuariocultivo' a.pk %}">Desactivar</a>
                {% else %}
                    <a href="{% url 'activar_usuariocultivo' a.pk %}">Activar</a>
                {% endif %}
            </td>
        </tr>
        {% empty %}
        <tr><td colspan="7">No hay asignaciones</td></tr>
        {% endfor %}
    </table>
</div>

<a href="{% url 'crear_usuariocultivo' %}" class="btn-primary">Crear Nueva Asignaci√≥n</a>
{% endblock %}
